<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portal de Productividad ESCOM - Grupo 2CM2</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --vino: #6d1d38; --azul: #008fcc; --verde: #28a745; --naranja: #e67e22; --rojo: #dc3545; --negro: #1a1a1a; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: url("fondo.jpg") no-repeat center center fixed; background-size: cover; }
    #login-screen, #survey-screen, #post-survey-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: rgba(0,0,0,0.85); position: fixed; width: 100%; z-index: 2000; }
    .card-ui { background: white; padding: 30px; border-radius: 20px; width: 500px; text-align: center; max-height: 85vh; overflow-y: auto; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    header { background: var(--vino); color: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
    main { display: grid; grid-template-columns: 350px 1fr; gap: 25px; max-width: 1400px; margin: 25px auto; padding: 0 20px; }
    .card-custom { background: rgba(255, 255, 255, 0.95); padding: 25px; border-radius: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .progress-bar-container { background: #eee; border-radius: 15px; height: 30px; overflow: hidden; margin: 15px 0; border: 1px solid #ddd; }
    .progress-fill { background: var(--azul); height: 100%; width: 0%; transition: width 2s cubic-bezier(0.1, 0.5, 0.5, 1); color: white; display: flex; align-items: center; justify-content: center; font-weight: bold; }
    .task-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .task-box { background: white; padding: 15px; border-radius: 12px; border-left: 10px solid var(--azul); display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
    .task-box.done { border-left-color: var(--verde); background: #f0fff0; }
    .btn-vino { background: var(--vino); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
    .btn-control { border: none; color: white; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 0.85em; }
    .log-monitor { background: #000; color: #00ff00; font-family: monospace; padding: 15px; height: 250px; overflow-y: auto; border-radius: 10px; text-align: left; font-size: 0.8em; }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div id="login-screen">
  <div class="card-ui" style="width:350px">
    <img src="mascota_escom.jpg" width="90">
    <h2 style="color:var(--vino)">Investigación 2CM2</h2>
    <input type="text" id="userInput" placeholder="Boleta (2026630001...)" style="width:90%; padding:10px; border-radius:8px; border:1px solid #ccc; margin-bottom:10px;">
    <input type="password" id="passInput" placeholder="Contraseña" style="width:90%; padding:10px; border-radius:8px; border:1px solid #ccc;">
    <button onclick="handleLogin()" class="btn-vino" style="width:95%; margin-top:15px">INGRESAR</button>
  </div>
</div>

<div id="survey-screen" class="hidden">
  <div class="card-ui"><h3>Evaluación de Diagnóstico</h3><div id="pre-qs" style="text-align:left; font-size:0.85em"></div><button onclick="saveSurvey('pre')" class="btn-vino" style="width:100%; margin-top:15px">Entrar al Dashboard</button></div>
</div>

<div id="post-survey-screen" class="hidden">
  <div class="card-ui"><h3>Evaluación de Impacto</h3><div id="post-qs" style="text-align:left; font-size:0.85em"></div><button onclick="saveSurvey('post')" class="btn-vino" style="width:100%; margin-top:15px; background:var(--azul)">Finalizar Prueba</button></div>
</div>

<div id="student-dash" class="hidden">
  <header>
    <div><strong>Portal Académico: <span id="studName"></span></strong></div>
    <div>
        <button onclick="document.getElementById('post-survey-screen').classList.remove('hidden')" style="background:var(--verde); color:white; border:none; padding:8px 15px; border-radius:10px; margin-right:15px; cursor:pointer; font-weight:bold;">Realizar Post-prueba</button>
        <button onclick="location.reload()" style="background:none; border:1px solid white; color:white; padding:5px 10px; border-radius:5px; cursor:pointer">Salir</button>
    </div>
  </header>
  <main>
    <aside>
        <div class="card-custom"><h4>Avance Curricular ISC 2020</h4><div class="progress-bar-container"><div id="pBar" class="progress-fill">0%</div></div></div>
        <div class="card-custom" style="background:var(--negro); color:white; text-align:center">
            <h4 id="pLabel">Técnica Pomodoro</h4>
            <div style="font-size:2.8em; font-weight:bold; margin:10px 0;" id="pTime">25:00</div>
            <div style="display:flex; gap:5px; justify-content:center; flex-wrap: wrap;">
                <button onclick="startPomo(25)" class="btn-control" style="background:var(--verde)">Iniciar</button>
                <button onclick="startPomo(5)" class="btn-control" style="background:var(--azul)">Descanso</button>
                <button onclick="pausePomo()" class="btn-control" style="background:var(--naranja)">Pausar</button>
                <button onclick="resetPomo()" class="btn-control" style="background:var(--rojo)">Reset</button>
            </div>
        </div>
    </aside>
    <section>
        <div class="card-custom">
            <h3>Gestor de Tareas y Plazos</h3>
            <div id="pendingList" class="task-grid"></div>
            <h4 style="margin-top:30px; color:var(--verde)">Tareas Completadas</h4>
            <div id="completedList" class="task-grid"></div>
        </div>
    </section>
  </main>
</div>

<div id="admin-dash" class="hidden">
  <header style="background:#333"><div><strong>PANEL DE CONTROL ADMINISTRATIVO</strong></div><button onclick="location.reload()" class="btn-vino">Salir</button></header>
  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px; padding:20px;">
    <div class="card-custom"><h3>Comparativa Pre vs Post</h3><canvas id="compareChart"></canvas></div>
    <div class="card-custom"><h3>Logs de Trazabilidad</h3><div id="logsBox" class="log-monitor"></div></div>
  </div>
</div>

<script>
  const preQuestions = ["¿Capacidad para cumplir plazos sin estrés?", "¿Nivel de sobrecarga cognitiva?", "¿Eficiencia percibida herramientas?", "¿Sentido control Mapa 2020?", "¿Necesidad recordatorios?", "¿Frecuencia olvido fechas?", "¿Estrés por desorganización?", "¿Calidad autogestión actual?", "¿Facilidad priorizar tareas?", "¿Confianza éxito académico?"];
  const postQuestions = ["¿Capacidad plazos mejoró?", "¿Prototipo redujo sobrecarga?", "¿Eficiencia del prototipo?", "¿Control real Mapa 2020?", "¿Recordatorios útiles?", "¿Reducción olvido fechas?", "¿Disminuyó estrés académico?", "¿Calidad autogestión sistema?", "¿Fácil priorizar con app?", "¿Confianza éxito con app?"];

  // NOMBRES REALES Y ÚNICOS 
  const nombresAlumnos = ["Ethan Eliud Ramirez Barajas", "Christopher Aguilera García", "Ismael Alvarado Olasagasti", "Esmeralda Arizbeth Chagoya", "Lilian Martínez Acosta", "Pamela Torres Martínez", "Rafael Mustafa Shakur", "Ángel Eduardo Hernández", "Gustavo Acosta Rojano", "Francisco Villano Rivera", "Liliana Suriken Villalba", "Emmanuel Morales González", "Osmar García Rodríguez", "Jose Luis Jacinto García", "Ivanna Zúñiga Alcántara", "Ithan Said Soto Estrada", "Rogelio Caballero Paz", "Valeria Diaquiz Palomeque", "Jorge Mendoza Martínez", "Oswaldo Corona Rojas", "Felix Aaron Ocampo", "Aldair Diaz Diaz", "Leonardo Vazquez Garza", "Einar Yasmani Hernandez", "Roberto Biali Torres", "Jaime Vargas Meléndez", "Nayeli Manuel Sanchez", "Javier Elizondo Escudero", "Jose Ernesto Villalpando", "Luis Quiroga Esquivel", "Maria Fernanda Cisneros", "Diego Campos Juarez", "Daniel Patino Farias", "Abigail Antonio Francisco", "Jorge Abraham Perez", "Israel Mendez Trejo", "Lucero Enriquez Soto"];

  const alumnosDB = nombresAlumnos.map((n, i) => ({
    u: "202663" + String(i + 1).padStart(4, '0'),
    p: "escom2026",
    n: n,
    av: 25 + Math.floor(Math.random() * 40)
  }));

  const materiasS1 = ["Matemáticas Discretas", "Análisis Vectorial", "Cálculo"];
  const materiasS2 = ["Cálculo Aplicado", "Ingeniería, Ética y Sociedad", "Algoritmos y Estructuras de Datos"];

  let tasks = JSON.parse(localStorage.getItem('tasks_final_p')) || [];
  let logs = JSON.parse(localStorage.getItem('logs_final_p')) || [];
  let preData = JSON.parse(localStorage.getItem('pre_final_p')) || [];
  let postData = JSON.parse(localStorage.getItem('post_final_p')) || [];
  let currentS = null;
  let pomoInterval;
  let secondsRemaining = 1500;

  if (tasks.length === 0) {
    alumnosDB.forEach((a, idx) => {
      if (idx === 0) return;
      let pool = [...materiasS2];
      if (idx < 12) pool.push(...materiasS1);
      else if (idx < 24) pool.push("Análisis Vectorial", "Cálculo");
      else pool.push("Cálculo");

      for(let i=1; i<=6; i++) tasks.push({ id: Math.random(), u: a.u, n: `${pool[Math.floor(Math.random()*pool.length)]}: Tarea ${i}`, d: '2025-11-20', done: true });
      for(let i=1; i<=5; i++) tasks.push({ id: Math.random(), u: a.u, n: `${pool[Math.floor(Math.random()*pool.length)]}: Tarea Pendiente ${i}`, d: '2026-01-30', done: false });
      preData.push({ u: a.u, ans: Array.from({length:10}, () => 1 + Math.floor(Math.random()*2)) });
      postData.push({ u: a.u, ans: Array.from({length:10}, () => 4 + Math.floor(Math.random()*1)) });
    });
    localStorage.setItem('tasks_final_p', JSON.stringify(tasks));
    localStorage.setItem('pre_final_p', JSON.stringify(preData));
    localStorage.setItem('post_final_p', JSON.stringify(postData));
  }

  function handleLogin() {
    const u = document.getElementById('userInput').value;
    if(u === "admin") { document.getElementById('login-screen').classList.add('hidden'); document.getElementById('admin-dash').classList.remove('hidden'); loadAdmin(); return; }
    const s = alumnosDB.find(a => a.u === u);
    if(s) {
        currentS = s;
        document.getElementById('login-screen').classList.add('hidden');
        renderSurvey('pre-qs', preQuestions, 'pre-ans');
        renderSurvey('post-qs', postQuestions, 'post-ans');
        document.getElementById('survey-screen').classList.remove('hidden');
    }
  }

  function renderSurvey(id, list, cl) {
    document.getElementById(id).innerHTML = list.map((q, i) => `<div style="margin-bottom:8px"><strong>${i+1}. ${q}</strong><br><input type="range" min="1" max="5" class="${cl}" style="width:100%"></div>`).join('');
  }

  function saveSurvey(t) {
    if(t==='pre') {
        document.getElementById('survey-screen').classList.add('hidden');
        document.getElementById('student-dash').classList.remove('hidden');
        document.getElementById('studName').textContent = currentS.n;
        setTimeout(() => { document.getElementById('pBar').style.width = currentS.av + "%"; document.getElementById('pBar').textContent = currentS.av + "%"; }, 500);
    } else { document.getElementById('post-survey-screen').classList.add('hidden'); alert("Impacto registrado."); }
    renderTasks();
  }

  function renderTasks() {
    const p = document.getElementById('pendingList'), c = document.getElementById('completedList');
    p.innerHTML = ""; c.innerHTML = "";
    tasks.filter(t => t.u === currentS.u).forEach(t => {
        const h = `<div class="task-box ${t.done?'done':''}"><div><b>${t.n}</b><br><small>${t.d}</small></div><button onclick="fT(${t.id})" class="btn-vino" style="background:var(--verde); padding:5px 10px">${t.done?'✓':'Listo'}</button></div>`;
        if(t.done) c.innerHTML += h; else p.innerHTML += h;
    });
  }

  function fT(id) { const t = tasks.find(x => x.id === id); if(!t.done){ t.done = true; renderTasks(); } }

  function startPomo(mins) {
    clearInterval(pomoInterval);
    secondsRemaining = mins * 60;
    const type = mins === 25 ? "Enfoque" : "Descanso";
    document.getElementById('pLabel').textContent = `Pomodoro (${type})`;
    pomoInterval = setInterval(() => {
        secondsRemaining--;
        updateUI();
        if(secondsRemaining <= 0) { clearInterval(pomoInterval); alert("Ciclo terminado"); }
    }, 1000);
  }

  function pausePomo() { clearInterval(pomoInterval); }

  function resetPomo() { clearInterval(pomoInterval); secondsRemaining = 1500; updateUI(); document.getElementById('pLabel').textContent = "Técnica Pomodoro"; }

  function updateUI() {
    const m = Math.floor(secondsRemaining / 60), s = secondsRemaining % 60;
    document.getElementById('pTime').textContent = `${m}:${s < 10 ? '0' : ''}${s}`;
  }

  function loadAdmin() {
    const getA = (d) => {
        if(!d.length) return Array(10).fill(0);
        let s = Array(10).fill(0); d.forEach(x => x.ans.forEach((v, i) => s[i]+=v));
        return s.map(v => v/d.length);
    };
    new Chart(document.getElementById('compareChart'), {
        type: 'bar',
        data: {
            labels: ['Q1', 'Q2', 'Q3', 'Q4', 'Q5', 'Q6', 'Q7', 'Q8', 'Q9', 'Q10'],
            datasets: [{ label: 'Pre (Diagnóstico)', data: getA(preData), backgroundColor: 'maroon' }, { label: 'Post (Impacto)', data: getA(postData), backgroundColor: 'blue' }]
        },
        options: { scales: { y: { beginAtZero: true, max: 5 } } }
    });
  }
</script>
</body>
</html>
