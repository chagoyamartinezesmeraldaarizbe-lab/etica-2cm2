<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistema de Gestión Académica - ESCOM</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --vino: #6d1d38; --azul: #008fcc; --verde: #28a745; --negro: #1a1a1a; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: url("fondo.jpg") center/cover fixed; color: #333; }
    
    /* Pantallas */
    #login-screen, #survey-screen { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: rgba(0,0,0,0.85); position: fixed; width: 100%; z-index: 2000; }
    .card-ui { background: white; padding: 30px; border-radius: 20px; width: 450px; text-align: center; max-height: 85vh; overflow-y: auto; }

    /* Header y Layout */
    header { background: var(--vino); color: white; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; }
    main { display: grid; grid-template-columns: 320px 1fr; gap: 20px; max-width: 1300px; margin: 20px auto; padding: 0 20px; }
    .card-custom { background: rgba(255,255,255,0.95); padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

    /* Alumno */
    .progress-fill { background: var(--azul); height: 30px; border-radius: 15px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; width: 0%; transition: 1s; }
    .task-item { background: white; padding: 15px; border-radius: 12px; margin-top: 10px; border-left: 5px solid var(--azul); display: flex; justify-content: space-between; align-items: center; }

    /* Administrador */
    .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding: 20px; }
    .log-monitor { background: #000; color: #00ff00; font-family: monospace; padding: 15px; height: 300px; overflow-y: auto; border-radius: 10px; text-align: left; font-size: 0.8em; }
    
    .hidden { display: none !important; }
    input, button { padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin: 5px 0; }
    button { cursor: pointer; border: none; font-weight: bold; }
  </style>
</head>
<body>

<div id="login-screen">
  <div class="card-ui" style="width:350px">
    <img src="mascota_escom.jpg" width="70">
    <h2 style="color:var(--vino)">Investigación 2CM2</h2>
    <input type="text" id="userInput" placeholder="Boleta o Administrador" style="width:90%">
    <input type="password" id="passInput" placeholder="Contraseña" style="width:90%">
    <button onclick="handleLogin()" style="width:95%; background:var(--vino); color:white; margin-top:10px">INGRESAR</button>
    <p id="error-msg" style="color:red; font-size:0.8em"></p>
  </div>
</div>

<div id="survey-screen" class="hidden">
  <div class="card-ui">
    <h3 style="color:var(--vino)">Encuesta Pre-Prueba (Productividad)</h3>
    <div id="questions-container" style="text-align:left; font-size:0.9em">
        </div>
    <button onclick="saveSurveyAndGo()" style="width:100%; background:var(--verde); color:white; margin-top:15px">Finalizar y Entrar</button>
  </div>
</div>

<div id="student-dash" class="hidden">
  <header>
    <div><strong>Alumno: <span id="studName"></span></strong></div>
    <button onclick="location.reload()" style="background:rgba(255,255,255,0.2); color:white">Salir</button>
  </header>
  <main>
    <aside>
        <div class="card-custom">
            <h4>Avance Curricular</h4>
            <div style="background:#ddd; border-radius:15px;"><div id="pBar" class="progress-fill">0%</div></div>
        </div>
        <div class="card-custom" style="background:var(--negro); color:white; text-align:center">
            <h4>Pomodoro</h4>
            <div style="font-size:2em">25:00</div>
            <button style="background:#e67e22; color:white">Enfocar</button>
        </div>
    </aside>
    <section>
        <div class="card-custom">
            <h4>Gestor de Tareas</h4>
            <input type="text" id="tIn" placeholder="Tarea..." style="width:60%">
            <button onclick="addTask()" style="background:var(--azul); color:white">Agregar</button>
            <div id="tList"></div>
        </div>
    </section>
  </main>
</div>

<div id="admin-dash" class="hidden">
  <header style="background:#333">
    <div><strong>PANEL DE CONTROL (CRISTOPHER AGUILERA)</strong></div>
    <button onclick="location.reload()" style="background:var(--vino); color:white">Cerrar Admin</button>
  </header>
  <div class="admin-grid">
    <div class="card-custom">
        <h3>Perfil de Productividad Grupal</h3>
        <canvas id="radarChart"></canvas>
    </div>
    <div class="card-custom">
        <h3>Trazabilidad de Alumnos (Logs)</h3>
        <div id="logsBox" class="log-monitor"></div>
        <button onclick="exportPDF()" style="width:100%; background:var(--azul); color:white; margin-top:15px">DESCARGAR EVIDENCIA PDF</button>
    </div>
  </div>
</div>

<script>
  const ADMIN_ACC = { u: "administrador", p: "admin2026" };
  const alumnosDB = [
    { u: "2026630001", p: "escom2026", n: "Pamela Torres Martinez", av: 45 },
    { u: "2026630009", p: "escom2026", n: "Esmeralda Arizbeth Chagoya Martinez", av: 48 },
    { u: "2026630011", p: "escom2026", n: "Ethan Eliud Ramirez Barajas", av: 46 },
    { u: "2026630024", p: "escom2026", n: "Ismael Alvarado Olasagasti", av: 48 },
    { u: "2026630037", p: "escom2026", n: "Lilian Martinez Acosta", av: 55 }
  ];

  const questions = [
    "¿Cumples plazos sin estrés?", "¿Sobrecarga por muchas plataformas?", "¿Tus herramientas son eficientes?", 
    "¿Controlas tu mapa curricular?", "¿Necesitas recordatorios?", "¿Olvidas fechas de entrega?", 
    "¿Estrés por desorganización?", "¿Calidad de tu autogestión?", "¿Fácil priorizar tareas?", "¿Confianza en la automatización?"
  ];

  let currentStudent = null;
  let logs = JSON.parse(localStorage.getItem('logs_etica')) || [];
  let surveys = JSON.parse(localStorage.getItem('surveys_etica')) || [];

  function handleLogin() {
    const u = document.getElementById('userInput').value;
    const p = document.getElementById('passInput').value;

    if(u === ADMIN_ACC.u && p === ADMIN_ACC.p) {
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('admin-dash').classList.remove('hidden');
        loadAdmin();
    } else {
        const s = alumnosDB.find(a => a.u === u && p === a.p);
        if(s) {
            currentStudent = s;
            document.getElementById('login-screen').classList.add('hidden');
            showSurvey();
            addLog(`Inicio de sesión: ${s.n}`);
        } else {
            document.getElementById('error-msg').textContent = "Usuario/Contraseña incorrectos";
        }
    }
  }

  function showSurvey() {
    const container = document.getElementById('questions-container');
    container.innerHTML = questions.map((q, i) => `
        <div style="margin-bottom:10px">
            <label>${i+1}. ${q}</label><br>
            <input type="range" min="1" max="5" class="s-ans" style="width:100%">
        </div>
    `).join('');
    document.getElementById('survey-screen').classList.remove('hidden');
  }

  function saveSurveyAndGo() {
    const answers = Array.from(document.querySelectorAll('.s-ans')).map(i => parseInt(i.value));
    surveys.push({ boleta: currentStudent.u, data: answers });
    localStorage.setItem('surveys_etica', JSON.stringify(surveys));
    
    document.getElementById('survey-screen').classList.add('hidden');
    document.getElementById('student-dash').classList.remove('hidden');
    document.getElementById('studName').textContent = currentStudent.n;
    setTimeout(() => {
        document.getElementById('pBar').style.width = currentStudent.av + "%";
        document.getElementById('pBar').textContent = currentStudent.av + "%";
    }, 500);
    addLog(`Encuesta finalizada por ${currentStudent.n}`);
  }

  function addLog(msg) {
    const time = new Date().toLocaleTimeString();
    logs.push(`[${time}] ${msg}`);
    localStorage.setItem('logs_etica', JSON.stringify(logs));
  }

  function addTask() {
    const val = document.getElementById('tIn').value;
    if(!val) return;
    const item = document.createElement('div');
    item.className = 'task-item';
    item.innerHTML = `<span>${val}</span><button onclick="this.parentElement.remove(); addLog('Tarea completada: ${val}')" style="background:var(--verde); color:white">Concluir</button>`;
    document.getElementById('tList').appendChild(item);
    addLog(`Tarea creada: ${val}`);
  }

  function loadAdmin() {
    const box = document.getElementById('logsBox');
    box.innerHTML = logs.map(l => `<div>> ${l}</div>`).reverse().join('');

    const avgs = [0,0,0,0,0,0,0,0,0,0];
    if(surveys.length > 0) {
        surveys.forEach(s => s.data.forEach((v, i) => avgs[i] += v));
        avgs.forEach((v, i) => avgs[i] = v / surveys.length);
    }

    new Chart(document.getElementById('radarChart'), {
        type: 'radar',
        data: {
            labels: ['Plazos', 'Carga', 'Eficiencia', 'Mapa', 'Record.', 'Olvido', 'Estrés', 'Gestión', 'Prioridad', 'Confianza'],
            datasets: [{ label: 'Promedio Grupo 2CM2', data: avgs, backgroundColor: 'rgba(109,29,56,0.5)', borderColor: '#6d1d38' }]
        },
        options: { scales: { r: { beginAtZero: true, max: 5 } } }
    });
  }

  function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.setFontSize(16);
    doc.text("Evidencia Trazabilidad Digital - Proyecto Ética", 10, 10);
    doc.setFontSize(10);
    logs.forEach((l, i) => doc.text(l, 10, 20 + (i * 7)));
    doc.save("Evidencia_2CM2.pdf");
  }
</script>
</body>
</html>
